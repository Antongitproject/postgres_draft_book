# pg_archivecleanup в PostgreSQL
pg_archivecleanup — это утилита командной строки PostgreSQL, которая используется для очистки архивов файлов журналов транзакций (WAL) в каталоге архива. Она предназначена для удаления старых или ненужных архивных файлов, что помогает управлять дисковым пространством и поддерживать каталог архива в порядке.

!!! info "Основное назначение"
    pg_archivecleanup используется для удаления старых файлов журналов WAL из архива. Это особенно полезно при настройке архивирования WAL, где накопление большого количества архивных файлов может привести к исчерпанию дискового пространства.

Синтаксис команды
pg_archivecleanup [OPTION]... ARCHIVEDIR OLDESTKEPTWALFILE

## Основные параметры
ARCHIVEDIR
Каталог, в котором хранятся архивные файлы WAL.

OLDESTKEPTWALFILE
Имя самого старого файла WAL, который должен быть оставлен. Все файлы старше этого будут удалены.

Опции
-d, --debug
Включить отладочный режим. В этом режиме выводится информация о каждом удаленном файле.

-n, --dry-run
Режим тестирования. Файлы не будут удалены, но будет показано, какие файлы были бы удалены.

-x, --extension=EXT
Указать расширение файлов, которые нужно удалить. По умолчанию используется расширение .backup.

-V, --version
Показать версию программы.

-?, --help
Показать справку по использованию команды.

## Примеры использования

Удаление старых файлов WAL в каталоге /var/lib/postgresql/archivedir, оставив только файлы начиная с 0000000100000000000000A1
pg_archivecleanup /var/lib/postgresql/archivedir 0000000100000000000000A1
Эта команда удалит все файлы WAL в каталоге /var/lib/postgresql/archivedir, которые старше файла 0000000100000000000000A1.

Тестовый запуск для проверки, какие файлы будут удалены
pg_archivecleanup -n /var/lib/postgresql/archivedir 0000000100000000000000A1
Эта команда покажет, какие файлы будут удалены, но не удалит их на самом деле.

Удаление файлов с пользовательским расширением .wal
pg_archivecleanup -x .wal /var/lib/postgresql/archivedir 0000000100000000000000A1
Эта команда удалит файлы с расширением .wal, которые старше указанного файла WAL.

## Полезные советы
Регулярно выполняйте очистку архива WAL, чтобы избежать переполнения диска.
Используйте режим --dry-run, чтобы проверить, какие файлы будут удалены, прежде чем выполнить фактическое удаление.
Убедитесь, что указанный файл OLDESTKEPTWALFILE существует, чтобы не удалить важные файлы WAL.

## Полезные ссылки
Документация по pg_archivecleanup
https://www.postgresql.org/docs/current/app-pgarchivecleanup.html
Архивирование и восстановление в PostgreSQL
https://www.postgresql.org/docs/current/continuous-archiving.html
pg_archivecleanup предоставляет эффективный способ управления архивными файлами WAL, обеспечивая возможность администрирования и очистки старых файлов, что помогает поддерживать дисковое пространство и организованность архива.