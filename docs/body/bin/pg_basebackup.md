# pg_basebackup в PostgreSQL
pg_basebackup — это утилита командной строки PostgreSQL, используемая для создания резервных копий базы данных в формате, пригодном для восстановления и использования в качестве реплики. Она позволяет создать полную резервную копию базы данных без необходимости остановки сервера.

!!! info "Основное назначение"
    pg_basebackup используется для создания резервных копий PostgreSQL, которые можно использовать для восстановления базы данных в случае сбоя или для настройки репликации. Утилита создает полную копию всех файлов данных, необходимых для запуска сервера.

Синтаксис команды
pg_basebackup [OPTION]...

## Основные параметры

-D, --pgdata=DIR
Указывает каталог, в который будет сохранена резервная копия. Этот параметр обязателен.

-F, --format=p|t
Указывает формат резервной копии: p для простого (plain) или t для tar архива. По умолчанию используется p.

-R, --write-recovery-conf
Автоматически создает файл конфигурации восстановления recovery.conf в каталоге назначения, полезный для настройки репликации.

-X, --wal-method=none|fetch|stream
Указывает метод обработки файлов журналов WAL:
none: Не включать WAL файлы в резервную копию.
fetch: Скопировать WAL файлы после создания резервной копии.
stream: Потоковая передача WAL файлов во время создания резервной копии.

-c, --checkpoint=fast|spread
Указывает метод выполнения контрольной точки: fast для быстрой контрольной точки или spread для распределенной.

-z, --gzip
Сжимает резервную копию с использованием gzip.

-v, --verbose
Выводит подробную информацию о процессе создания резервной копии.

-P, --progress
Показывает прогресс выполнения.

-h, --host=HOSTNAME
Указывает хост, на котором работает сервер базы данных.

-p, --port=PORT
Указывает порт, на котором сервер базы данных принимает соединения.

-U, --username=USERNAME
Указывает имя пользователя для подключения к серверу базы данных.

-w, --no-password
Никогда не запрашивать пароль.

-W, --password
Всегда запрашивать пароль перед подключением.

-?, --help
Показать справку по использованию команды.

## Примеры использования
Создание простой резервной копии в каталоге /var/lib/postgresql/backup
pg_basebackup -D /var/lib/postgresql/backup
Эта команда создаст простую резервную копию текущей базы данных в указанном каталоге.

Создание резервной копии в формате tar с указанием хоста и порта
pg_basebackup -D /var/lib/postgresql/backup -F t -h mydbhost -p 5432
Эта команда создаст резервную копию в формате tar, подключаясь к серверу PostgreSQL на указанном хосте и порту.

Создание резервной копии с потоковой передачей WAL файлов
pg_basebackup -D /var/lib/postgresql/backup -X stream
Эта команда создаст резервную копию с потоковой передачей WAL файлов, что полезно для создания актуальных резервных копий.

Создание резервной копии с сжатием gzip и показом прогресса
pg_basebackup -D /var/lib/postgresql/backup -z -P
Эта команда создаст сжатую резервную копию и покажет прогресс выполнения.

## Полезные советы
Регулярно создавайте резервные копии с помощью pg_basebackup, чтобы иметь актуальные копии для восстановления в случае сбоя.
Используйте параметр -R для автоматической настройки репликации, если резервная копия будет использоваться в качестве реплики.
Выбирайте подходящий метод передачи WAL файлов (fetch или stream) в зависимости от ваших требований и конфигурации сервера.

## Полезные ссылки
Документация по pg_basebackup
https://www.postgresql.org/docs/current/app-pgbasebackup.html
Резервное копирование и восстановление в PostgreSQL
https://www.postgresql.org/docs/current/backup.html

pg_basebackup является мощным и удобным инструментом для создания полных резервных копий базы данных PostgreSQL, обеспечивая надежное средство для восстановления данных и настройки репликации.
