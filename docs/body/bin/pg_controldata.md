# pg_controldata в PostgreSQL
pg_controldata — это утилита командной строки PostgreSQL, которая отображает содержимое файла управления (control file) базы данных. Этот файл содержит важную информацию о состоянии базы данных, такую как версия базы данных, параметры конфигурации, время последнего контрольного сохранения и другую метаинформацию. Утилита полезна для администраторов баз данных при диагностике и восстановлении.

!!! info "Основное назначение"
    pg_controldata используется для получения подробной информации о текущем состоянии экземпляра базы данных PostgreSQL. Это включает в себя версии, параметры конфигурации и текущее состояние базы данных. Утилита полезна для диагностики и мониторинга, а также для планирования восстановления после сбоев.

Синтаксис команды
pg_controldata [OPTION] [DATADIR]

## Параметры
DATADIR
Каталог данных PostgreSQL, в котором находится файл управления базой данных. Если не указан, используется значение из переменной окружения PGDATA.

Опции

-?, --help
Показать справку по использованию команды.

-V, --version
Показать версию программы pg_controldata.

## Примеры использования

Отображение данных управления для каталога данных по умолчанию
pg_controldata
Эта команда выведет содержимое файла управления для базы данных в каталоге, указанном в переменной окружения PGDATA.

Отображение данных управления для конкретного каталога данных
pg_controldata /var/lib/postgresql/data
Эта команда выведет содержимое файла управления для базы данных, расположенной в указанном каталоге данных.

Вывод команды
Вывод команды pg_controldata содержит множество информации о состоянии базы данных. Вот пример:

pg_control version number:            1300
Catalog version number:               202007201
Database system identifier:           6890674521235601301
Database cluster state:               in production
pg_control last modified:             Thu 10 Jun 2021 10:15:26 AM UTC
Latest checkpoint location:           0/3000028
Prior checkpoint location:            0/2000060
...
Основные параметры в выводе

pg_control version number
Номер версии файла управления.

Catalog version number
Номер версии каталога базы данных.

Database system identifier
Идентификатор системы базы данных.

Database cluster state
Текущее состояние кластера базы данных (например, in production).

pg_control last modified
Дата и время последнего изменения файла управления.

Latest checkpoint location
Местоположение последнего контрольного сохранения.

Prior checkpoint location
Местоположение предыдущего контрольного сохранения.

Database cluster state
Состояние кластера базы данных (например, shut down in recovery или in production).

Database cluster state
Состояние кластера базы данных (например, shut down, in production).

Minimum/Maximum data alignment
Минимальное/Максимальное выравнивание данных.

Maximum length of identifiers
Максимальная длина идентификаторов.

Maximum columns in an index
Максимальное количество столбцов в индексе.

## Полезные советы
Мониторинг состояния: Используйте pg_controldata для проверки текущего состояния базы данных и параметров конфигурации, особенно после неожиданного отключения или сбоя системы.
Планирование восстановления: Информация о контрольных точках и идентификаторах транзакций может быть полезна при планировании восстановления базы данных.
Сравнение конфигураций: Сравнивайте выводы pg_controldata на разных серверах для диагностики и устранения проблем с конфигурацией или состоянием базы данных.

## Полезные ссылки
Документация по pg_controldata
https://www.postgresql.org/docs/current/app-pgcontroldata.html
Управление файлами и контрольными точками в PostgreSQL
https://www.postgresql.org/docs/current/storage-file-layout.html

pg_controldata является важным инструментом для администраторов баз данных PostgreSQL, предоставляя подробную информацию о состоянии и конфигурации экземпляра базы данных, что способствует более эффективной диагностике и управлению.