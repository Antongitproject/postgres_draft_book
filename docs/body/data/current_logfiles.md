# current_logfiles

Файл `current_logfiles` в PostgreSQL является частью системы ведения логов и управляется подсистемой журнала ошибок. Этот файл используется для отслеживания текущих журналов, куда записываются сообщения об ошибках и другой диагностической информации. Он помогает системному администратору или PostgreSQL в автоматическом управлении логами. Вот подробное описание назначения и содержания файла `current_logfiles`:

### Назначение файла `current_logfiles`

1. **Отслеживание текущих журналов:**
   - Файл `current_logfiles` используется для отслеживания файлов журналов, которые в настоящее время активны и используются для записи логов PostgreSQL. Это позволяет системе и администраторам легко определить, какие файлы содержат текущие логи.

2. **Управление логированием:**
   - Он упрощает управление логированием, позволяя PostgreSQL и инструментам администрирования быстро находить и работать с актуальными файлами журналов.

### Содержание файла `current_logfiles`

Файл `current_logfiles` содержит информацию в текстовом формате, где каждая строка представляет собой сопоставление типа журнала и соответствующего файла. Обычно каждая строка имеет следующий формат:

```
<логический тип журнала> <путь к файлу журнала>
```

### Пример содержимого файла `current_logfiles`

Вот пример того, как может выглядеть содержимое файла `current_logfiles`:

```
stderr log/postgresql.log
csvlog log/postgresql.csv
```

В этом примере:
- `stderr` указывает, что сообщения, отправляемые на стандартный поток ошибок (stderr), записываются в файл `log/postgresql.log`.
- `csvlog` указывает, что сообщения в формате CSV записываются в файл `log/postgresql.csv`.

### Использование файла `current_logfiles`

1. **Определение текущих файлов журналов:**
   - При необходимости узнать, в какие файлы в настоящее время записываются логи, можно просто прочитать содержимое файла `current_logfiles`. Это полезно для администраторов при мониторинге и анализе логов.

2. **Автоматическое управление логами:**
   - Инструменты и скрипты автоматизации могут использовать этот файл для управления файлами журналов, такими как архивирование старых логов или ротация логов.

3. **Смена файлов журналов:**
   - Когда PostgreSQL переключается на новый файл журнала (например, из-за ротации логов), файл `current_logfiles` обновляется, чтобы отразить новое местоположение активных логов.

### Пример использования

Предположим, что администратор базы данных хочет настроить скрипт для автоматического архивирования текущих логов. Скрипт может читать файл `current_logfiles`, чтобы узнать, какие файлы в настоящее время используются для логирования, и скопировать эти файлы в архивное хранилище.

```bash
#!/bin/bash

# Путь к файлу current_logfiles
CURRENT_LOGFILES="/var/lib/pgsql/current_logfiles"

# Чтение файла current_logfiles
while read -r line; do
  # Извлечение типа журнала и пути к файлу журнала
  log_type=$(echo $line | cut -d ' ' -f 1)
  log_file=$(echo $line | cut -d ' ' -f 2)

  # Копирование текущего файла журнала в архив
  cp "/var/lib/pgsql/$log_file" "/path/to/archive/$log_file.$(date +%Y%m%d%H%M%S)"
done < "$CURRENT_LOGFILES"
```

Этот скрипт читает файл `current_logfiles`, извлекает пути к текущим логам и копирует их в архив с меткой времени.

### Заключение

Файл `current_logfiles` является ключевым элементом системы управления логами PostgreSQL. Он предоставляет информацию о текущих файлах журналов, упрощая их мониторинг и управление. Администраторы и автоматизированные системы могут использовать этот файл для эффективного управления логами, обеспечения их сохранности и упрощения задач по анализу и архивированию логов.
